{% extends "base.html" %}

{% block title %}Posts in {{ category.name }} - {{ super() }}{% endblock %}

{% block headerbar %}
<adw-header-bar>
    <adw-window-title slot="title" title="Category: {{ category.name }}"></adw-window-title>
    <adw-button slot="start" icon-name="go-previous-symbolic" href="{{ url_for('general.index') }}" aria-label="Back to Home"></adw-button>
</adw-header-bar>
{% endblock %}

{% block content %}
<adw-clamp class="adw-clamp-xl" style="padding-top: var(--spacing-l);">
    <adw-box orientation="vertical" spacing="l">

        <div style="text-align: center; margin-bottom: var(--spacing-m);">
          <adw-spinner id="category-loading-spinner" size="l" style="display: none;"></adw-spinner>
        </div>

        {% if posts %}
            <div class="blog-posts-container"> {# Use new card container #}
                {% for post in posts %}
                <article class="adw-card blog-post-item-card">
                    <header class="blog-post-card__header">
                        <h2 class="adw-title-2 blog-post-card__title">
                            <a href="{{ url_for('post.view_post', post_id=post.id) }}" class="adw-link">{{ post.title }}</a>
                        </h2>
                        <div class="blog-post-card__meta adw-label caption">
                            By: <a href="{{ url_for('profile.view_profile', user_id=post.author.id) }}" class="adw-link">{{ post.author.full_name if post.author else 'Unknown Author' }}</a>
                            on <time datetime="{{ post.created_at.isoformat() }}">{{ post.created_at.strftime('%Y-%m-%d') if post.created_at else 'Unknown date' }}</time>
                        </div>
                    </header>
                    {% if post.content %}
                    <div class="blog-post-card__excerpt styled-text-content">
                     {{ (post.content | truncate(600) | markdown ) if post.content else '' }}
                    </div>
                    {% endif %}
                    <footer class="blog-post-card__footer">
                        <div class="blog-post-card__terms">
                            {% if post.categories %}
                            <div class="post-categories-list meta-section">
                                <strong class="adw-label caption meta-label-strong">Categories:</strong>
                                {% for cat_item in post.categories %}
                                    <a href="{{ url_for('post.posts_by_category', category_slug=cat_item.slug) }}" class="adw-button flat compact">{{ cat_item.name }}</a>
                                {% endfor %}
                            </div>
                            {% endif %}
                            {% if post.tags %}
                            <div class="tags-summary meta-section">
                                <strong class="adw-label caption meta-label-strong">Tags:</strong>
                                {% for tag_item in post.tags %}
                                  <a href="{{ url_for('post.posts_by_tag', tag_slug=tag_item.slug) }}" class="adw-button flat compact">{{ tag_item.name }}</a>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        <a href="{{ url_for('post.view_post', post_id=post.id) }}" class="adw-button flat read-more-link">Read More <span class="adw-icon icon-actions-go-next-symbolic"></span></a>
                    </footer>
                    <div class="adw-card__actions card-secondary-actions">
                        {% from "_macros.html" import render_like_button %}
                        {{ render_like_button(post, 'post') }}
                    </div>
                </article>
                {% endfor %}
            </div>

            {% if pagination and pagination.pages > 1 %}
            <div class="adw-box adw-box-horizontal" style="margin-top: var(--spacing-l);">
                {{ render_pagination(pagination, 'post.posts_by_category', category_slug=category.slug) }}
            </div>
            {% endif %}
        {% else %}
             <adw-status-page icon-name="empty-symbolic" title="No Posts Found" description="There are no posts in the category '{{ category.name }}'.">
                <adw-button slot="actions" text="View All Posts" href="{{ url_for('general.index') }}"></adw-button>
            </adw-status-page>
        {% endif %}
    </adw-box>
</adw-clamp>

<style>
/* Custom styling for card-like rows if needed, and tag buttons */
.card-like-row {
    /* You might not need this if adw-action-row default styling is sufficient */
}
.tag-button {
    /* font-size: var(--font-size-caption); */
    /* padding: var(--spacing-xxs) var(--spacing-xs); */
}
.wrap-box {
    flex-wrap: wrap;
}
</style>
{% endblock %}
