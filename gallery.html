<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adwaita Web Components Gallery</title>
    <link rel="stylesheet" href="static/css/adwaita-web.css">
    <script src="static/js/components.js" defer></script>
    <style>
        body {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        .widget-section {
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
        }
        .widget-section h2 {
            margin-top: 0;
        }
        /* Helper for fixed size containers if needed */
        .fixed-size-container {
            width: 400px;
            height: 300px;
            border: 1px dashed #999;
            margin-top: 10px;
            position: relative; /* For absolutely positioned children like in split views */
            overflow: hidden; /* For split views */
        }
         .medium-size-container {
            width: 700px;
            height: 400px;
            border: 1px dashed #999;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }
        .tall-size-container {
            width: 300px;
            height: 500px;
            border: 1px dashed #999;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }
        .responsive-container {
            width: 100%; /* Test responsiveness */
            max-width: 800px;
            min-width: 300px;
            height: 400px;
            border: 1px solid #888;
            resize: horizontal;
            overflow: auto;
            margin-top: 10px;
            position: relative;
        }
        /* Simple page content for nav views */
        .sample-page {
            padding: 20px;
            background-color: var(--view-background-color);
            border: 1px solid var(--borders-color);
            border-radius: 6px;
            height: 100%;
            box-sizing: border-box;
        }
        .sample-page h3 { margin-top: 0; }
    </style>
</head>
<body>

    <h1>Adwaita Web Components Gallery (New Widgets)</h1>
    <p>Use browser dev tools to inspect elements and their shadow DOM.</p>
    <button onclick="Adw.toggleTheme()">Toggle Dark Mode</button>
     <select id="accent-color-selector" onchange="Adw.setAccentColor(this.value)">
        <option value="">Default Accent</option>
        <!-- Options will be populated by JS -->
    </select>

    <!-- Dialogs Section -->
    <section class="widget-section">
        <h2>Dialogs</h2>
        <adw-button id="show-alert-dialog">Show Alert Dialog</adw-button>
        <adw-button id="show-about-dialog">Show About Dialog</adw-button>
        <adw-button id="show-prefs-dialog">Show Preferences Dialog</adw-button>

        <!-- AdwAlertDialog (controlled by JS) -->
        <!-- AdwAboutDialog (controlled by JS) -->
        <!-- AdwPreferencesDialog (controlled by JS) -->
        <adw-preferences-page name="general" title="General" style="display:none;">
            <adw-preferences-group title="Appearance">
                <adw-switch-row title="Enable Feature X" subtitle="This will turn on feature X."></adw-switch-row>
                <adw-combo-row id="theme-combo" title="Theme" subtitle="Select application theme.">
                    <!-- JS will populate options -->
                </adw-combo-row>
            </adw-preferences-group>
        </adw-preferences-page>
        <adw-preferences-page name="advanced" title="Advanced" style="display:none;">
            <adw-preferences-group title="Networking">
                <adw-entry-row title="Proxy Server" placeholder="e.g., 127.0.0.1:8080"></adw-entry-row>
            </adw-preferences-group>
        </adw-preferences-page>
    </section>

    <!-- Rows Section -->
    <section class="widget-section">
        <h2>Rows</h2>
        <adw-list-box>
            <adw-spin-row title="Volume Level" subtitle="Adjust the master volume" value="50" min="0" max="100" step="5"></adw-spin-row>
            <adw-button-row centered>
                <adw-button suggested>Apply</adw-button>
                <adw-button>Cancel</adw-button>
            </adw-button-row>
            <adw-button-row>
                 <adw-button flat destructive>Delete All</adw-button>
            </adw-button-row>
        </adw-list-box>
    </section>

    <!-- Tabs Section -->
    <section class="widget-section">
        <h2>Tabs (AdwTabView)</h2>
        <div class="medium-size-container">
            <adw-tab-view id="main-tab-view" active-page-name="tab1" show-new-tab-button>
                <adw-tab-page page-name="tab1" label="Tab One">
                    <div class="sample-page"><h3>Content for Tab 1</h3><p>Some text here.</p></div>
                </adw-tab-page>
                <adw-tab-page page-name="tab2" label="Tab Two (Closable)">
                    <div class="sample-page"><h3>Content for Tab 2</h3><adw-button>A button</adw-button></div>
                </adw-tab-page>
                <adw-tab-page page-name="tab3" label="Tab Three (Non-Closable)" non-closable>
                     <div class="sample-page"><h3>Content for Tab 3</h3><p>This tab cannot be closed by default UI.</p></div>
                </adw-tab-page>
            </adw-tab-view>
        </div>
    </section>

    <!-- Navigation View Section -->
    <section class="widget-section">
        <h2>Navigation View (AdwNavigationView)</h2>
        <div class="medium-size-container" style="display: flex; flex-direction: column;">
            <adw-navigation-view id="main-nav-view">
                <!-- Initial page defined in JS -->
            </adw-navigation-view>
        </div>
    </section>

    <!-- Bottom Sheet Section -->
    <section class="widget-section">
        <h2>Bottom Sheet (AdwBottomSheet)</h2>
        <adw-button id="show-bottom-sheet">Show Bottom Sheet</adw-button>
        <!-- Content for bottom sheet -->
        <div id="bottom-sheet-content" style="display: none;">
            <adw-list-box style="margin:0; border:none; box-shadow:none;">
                <adw-action-row title="Share" subtitle="Share this item with others"></adw-action-row>
                <adw-action-row title="Edit" subtitle="Modify the item"></adw-action-row>
                <adw-action-row title="Delete" subtitle="Remove this item permanently"></adw-action-row>
                <adw-button-row centered style="padding-top: 10px;">
                    <adw-button flat id="close-bottom-sheet-button">Cancel</adw-button>
                </adw-button-row>
            </adw-list-box>
        </div>
    </section>

    <!-- Layout Widgets Section -->
    <section class="widget-section">
        <h2>Layout Widgets</h2>

        <h3>AdwBin</h3>
        <adw-bin style="width: 200px; height: 100px; border: 1px solid blue; padding: 5px;">
            <adw-button>Centered by Parent Flex (Potentially)</adw-button>
        </adw-bin>

        <h3>AdwWrapBox</h3>
        <adw-wrap-box spacing="10" line-spacing="20" style="border: 1px solid green; padding: 10px; max-width: 350px;">
            <adw-button>Button 1</adw-button>
            <adw-button suggested>Button 2 (Suggested)</adw-button>
            <adw-button destructive>Button 3 (Destructive)</adw-button>
            <adw-button>Button 4</adw-button>
            <adw-button flat>Button 5 (Flat)</adw-button>
            <adw-entry placeholder="Entry in wrapbox"></adw-entry>
        </adw-wrap-box>

        <h3>AdwClamp</h3>
        <adw-clamp maximum-size="50ch" style="border: 1px solid purple; padding: 10px;">
            <div style="background: #eee; padding: 10px;">
                <p>This content is clamped. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
            </div>
        </adw-clamp>

        <h3>AdwBreakpointBin</h3>
        <p>Resize container below (drag corner if browser supports `resize: horizontal` on divs, or resize window).</p>
        <adw-breakpoint-bin class="responsive-container" default-child-name="small">
            <div name="small" data-condition="0" style="background-color: lightblue; padding:10px;">Content for SMALL (0px+)</div>
            <div name="medium" data-condition="500" style="background-color: lightgreen; padding:10px;">Content for MEDIUM (500px+)</div>
            <div name="large" data-condition="700" style="background-color: lightcoral; padding:10px;">Content for LARGE (700px+)</div>
        </adw-breakpoint-bin>
    </section>

    <!-- Toolbar View Section -->
    <section class="widget-section">
        <h2>Toolbar View (AdwToolbarView)</h2>
        <div class="medium-size-container" style="display: flex;">
            <adw-toolbar-view id="my-toolbar-view" top-bar-revealed bottom-bar-revealed>
                <div slot="top-bar" style="display:flex; align-items: center; padding: 5px; background: var(--headerbar-background-color); border-bottom: 1px solid var(--borders-color);">
                    <adw-button flat circular icon="<svg viewBox='0 0 16 16'><path d='M2 8a.5.5 0 01.5-.5h11a.5.5 0 010 1h-11A.5.5 0 012 8zM2 4a.5.5 0 01.5-.5h11a.5.5 0 010 1h-11A.5.5 0 012 4zM2 12a.5.5 0 01.5-.5h11a.5.5 0 010 1h-11A.5.5 0 012 12z'/></svg>"></adw-button>
                    <span style="margin-left:10px; font-weight:bold;">Top Bar</span>
                </div>
                <div class="sample-page" style="height:100%; box-sizing: border-box;">
                    <h3>Main Content Area</h3>
                    <p>Scrollable content if it overflows...</p>
                    <p>Lorem ipsum dolor sit amet...</p>
                    <adw-button onclick="document.getElementById('my-toolbar-view').toggleTopBar()">Toggle Top Bar</adw-button>
                    <adw-button onclick="document.getElementById('my-toolbar-view').toggleBottomBar()">Toggle Bottom Bar</adw-button>
                </div>
                <div slot="bottom-bar" style="display:flex; justify-content:space-around; padding: 10px; background: var(--headerbar-background-color); border-top: 1px solid var(--borders-color);">
                    <adw-button flat>Action 1</adw-button>
                    <adw-button flat>Action 2</adw-button>
                    <adw-button flat>Action 3</adw-button>
                </div>
            </adw-toolbar-view>
        </div>
    </section>

    <!-- Carousel Section -->
    <section class="widget-section">
        <h2>Carousel (AdwCarousel)</h2>
        <div style="max-width: 500px; margin: auto;">
            <adw-carousel id="my-carousel" show-nav-buttons autoplay loop indicator-style="dots">
                <div style="background-color: lightcoral; height: 200px; display:flex; align-items:center; justify-content:center; font-size: 2em;">Slide 1</div>
                <img src="https://via.placeholder.com/500x200/lightgreen/000?text=Slide+2" alt="Slide 2" data-thumbnail="https://via.placeholder.com/40x30/lightgreen/000?text=S2">
                <div style="background-color: lightblue; height: 200px; display:flex; align-items:center; justify-content:center; font-size: 2em;" data-thumbnail="https://via.placeholder.com/40x30/lightblue/000?text=S3">Slide 3</div>
            </adw-carousel>
        </div>
         <adw-button onclick="document.getElementById('my-carousel').prev()">Prev</adw-button>
         <adw-button onclick="document.getElementById('my-carousel').next()">Next</adw-button>
         <adw-button onclick="document.getElementById('my-carousel').goTo(0)">Go to Slide 1</adw-button>
    </section>

    <!-- Toggle Group Section -->
    <section class="widget-section">
        <h2>Toggle Group (AdwToggleGroup)</h2>
        <h3>Standard</h3>
        <adw-toggle-group id="tg1" active-value="opt2">
            <adw-toggle-button label="Option 1" value="opt1"></adw-toggle-button>
            <adw-toggle-button label="Option 2" value="opt2"></adw-toggle-button>
            <adw-toggle-button label="Option 3" value="opt3" disabled></adw-toggle-button>
        </adw-toggle-group>
        <p>Selected: <span id="tg1-value"></span></p>

        <h3>Linked</h3>
        <adw-toggle-group linked id="tg2" active-value="b">
            <adw-toggle-button value="a">Alpha</adw-toggle-button>
            <adw-toggle-button value="b">Beta</adw-toggle-button>
            <adw-toggle-button value="g">Gamma</adw-toggle-button>
        </adw-toggle-group>
         <p>Selected: <span id="tg2-value"></span></p>
    </section>

    <!-- Split Views Section -->
    <section class="widget-section">
        <h2>Split Views</h2>

        <h3>Navigation Split View</h3>
        <div class="medium-size-container" id="nav-split-container">
            <adw-navigation-split-view id="my-nav-split-view" sidebar-width="250px" collapse-threshold="600">
                <div slot="sidebar" class="sample-page">
                    <h4>Sidebar</h4>
                    <ul><li>Item 1</li><li>Item 2</li></ul>
                    <adw-button onclick="document.getElementById('my-nav-split-view').toggleSidebar()">Toggle Sidebar via method</adw-button>
                </div>
                <div slot="content" class="sample-page">
                    <h4>Main Content Area</h4>
                    <p>This is the primary content.</p>
                </div>
            </adw-navigation-split-view>
        </div>
        <adw-button onclick="document.getElementById('my-nav-split-view').showSidebar()">Show NavSplit Sidebar</adw-button>
        <adw-button onclick="document.getElementById('my-nav-split-view').hideSidebar()">Hide NavSplit Sidebar</adw-button>


        <h3>Overlay Split View</h3>
         <div class="medium-size-container" id="overlay-split-container">
            <adw-overlay-split-view id="my-overlay-split-view" sidebar-width="280px" show-sidebar>
                <div slot="sidebar" class="sample-page">
                    <h4>Overlay Sidebar</h4>
                    <p>This sidebar always overlays.</p>
                    <adw-button onclick="document.getElementById('my-overlay-split-view').hideSidebar()">Close Me</adw-button>
                </div>
                <div slot="content" class="sample-page">
                    <h4>Main Content for Overlay</h4>
                    <p>Content here.</p>
                    <adw-button onclick="document.getElementById('my-overlay-split-view').showSidebar()">Show Overlay Sidebar</adw-button>

                </div>
            </adw-overlay-split-view>
        </div>
    </section>


    <script>
    // Setup for Dialogs
    const alertDialogButton = document.getElementById('show-alert-dialog');
    alertDialogButton.addEventListener('click', () => {
        const alertDialog = Adw.createAlertDialog("This is an alert message body.", {
            heading: "Alert Heading",
            choices: [
                { label: "Cancel", value: "cancel" },
                { label: "OK", value: "ok", style: "suggested" }
            ],
            onResponse: (value) => console.log("Alert response:", value)
        });
        alertDialog.open();
    });

    const aboutDialogButton = document.getElementById('show-about-dialog');
    aboutDialogButton.addEventListener('click', () => {
        const aboutDialog = Adw.createAboutDialog({
            appName: "My Awesome App",
            appIcon: "🚀", // Placeholder
            version: "1.2.3",
            copyright: "© 2023 Yourself",
            developerName: "You",
            website: "https://example.com",
            comments: "A great application for doing amazing things with web technologies.",
            licenseType: "MIT",
            developers: ["Jane Doe (Lead)", "John Smith"],
            designers: ["Alice Wonderland"],
            acknowledgements: [
                {title: "Libraries Used", names: ["AdwaitaWeb.js", "HyperHTML.js"]},
                "Special thanks to the GNOME community."
            ]
        });
        aboutDialog.open();
    });

    const prefsDialogButton = document.getElementById('show-prefs-dialog');
    prefsDialogButton.addEventListener('click', () => {
        const generalPage = document.querySelector('adw-preferences-page[name="general"]').cloneNode(true);
        const advancedPage = document.querySelector('adw-preferences-page[name="advanced"]').cloneNode(true);
        generalPage.style.display = ''; // Make them visible for the dialog
        advancedPage.style.display = '';

        const themeComboRow = generalPage.querySelector('#theme-combo');
        if (themeComboRow && themeComboRow.selectOptions === undefined) { // Crude check if WC method exists
             const selectEl = themeComboRow.shadowRoot.querySelector('select');
             if(selectEl) {
                selectEl.innerHTML = '<option value="default">Default</option><option value="light">Light</option><option value="dark">Dark</option>';
             }
        } else if (themeComboRow) {
            themeComboRow.selectOptions = [ {label: "Default", value: "default"}, {label: "Light", value: "light"}, {label: "Dark", value: "dark"} ];
        }


        const prefsDialog = Adw.createPreferencesDialog({
            title: "Application Settings",
            pages: [
                { name: "general", title: "General Settings", pageElement: generalPage },
                { name: "advanced", title: "Advanced Config", pageElement: advancedPage }
            ],
            initialPageName: "general",
            onClose: () => console.log("Preferences dialog closed")
        });
        prefsDialog.open();
    });

    // Setup for AdwTabView
    const tabView = document.getElementById('main-tab-view');
    let newTabCounter = 0;
    tabView.addEventListener('new-tab-requested', () => {
        newTabCounter++;
        const newPageName = `new-tab-${newTabCounter}`;
        const newPageContent = document.createElement('div');
        newPageContent.className = 'sample-page';
        newPageContent.innerHTML = `<h3>Content for New Tab ${newTabCounter}</h3><p>Dynamically added.</p>`;

        const newTabPage = document.createElement('adw-tab-page');
        newTabPage.setAttribute('page-name', newPageName);
        newTabPage.setAttribute('label', `New Tab ${newTabCounter}`);
        newTabPage.appendChild(newPageContent);

        tabView.addPage(newTabPage, true); // Add and make active
    });
    tabView.addEventListener('before-page-close', (e) => {
        if (e.detail.pageName === 'tab1') {
            if (!confirm("Are you sure you want to close Tab One? It has unsaved data!")) {
                e.preventDefault(); // Prevent closing
            }
        }
    });
     tabView.addEventListener('page-changed', (e) => console.log('TabView page changed:', e.detail.pageName));
     tabView.addEventListener('page-closed', (e) => console.log('TabView page closed:', e.detail.pageName));


    // Setup for AdwNavigationView
    const navView = document.getElementById('main-nav-view');
    if (navView) {
        const page1 = document.createElement('div');
        page1.className = 'sample-page';
        page1.innerHTML = `<h3>Home Page</h3><p>This is the first page in the navigation view.</p><adw-button id="nav-to-page2">Go to Page 2</adw-button>`;
        page1.setAttribute('data-page-name', 'home');
        page1.querySelector('#nav-to-page2').onclick = () => {
            const page2 = document.createElement('div');
            page2.className = 'sample-page';
            page2.innerHTML = `<h3>Page 2</h3><p>Details about something.</p><adw-button id="nav-to-page3">Go to Page 3 (No Header Items)</adw-button>`;
            page2.setAttribute('data-page-name', 'page2');
            page2.querySelector('#nav-to-page3').onclick = () => {
                 const page3 = document.createElement('div');
                 page3.className = 'sample-page';
                 page3.innerHTML = `<h3>Page 3</h3><p>Final page in this stack.</p>`;
                 page3.setAttribute('data-page-name', 'page3');
                 navView.push(page3); // page3 has no header items
            };
            navView.push({
                name: 'page2',
                element: page2,
                header: { title: "Page Two", subtitle: "Details View", end: [Adw.createButton("Save", {suggested:true})] }
            });
        };
        // Add initial page directly to light DOM for WC to pick up, or use push if WC is already fully initialized.
        // For simplicity here, we assume WC can pick it up or we'd push after ensuring it's ready.
        // navView.appendChild(page1); // This would trigger slot observer
        // For programmatic factory usage, it's simpler:
        navView.push({name: 'home', element: page1, header: {title: "Home"}});

        navView.addEventListener('pushed', (e) => console.log('NavView pushed:', e.detail.pageName));
        navView.addEventListener('popped', (e) => console.log('NavView popped:', e.detail.pageName));
    }

    // Setup for AdwBottomSheet
    let bottomSheetInstance;
    const showBottomSheetButton = document.getElementById('show-bottom-sheet');
    const bottomSheetContent = document.getElementById('bottom-sheet-content');
    const closeBottomSheetButton = document.getElementById('close-bottom-sheet-button');

    showBottomSheetButton.addEventListener('click', () => {
        if (!bottomSheetInstance) {
            bottomSheetInstance = Adw.createBottomSheet({
                content: bottomSheetContent.cloneNode(true), // Important to clone if reusing
                onOpen: () => console.log("Bottom sheet opened"),
                onClose: () => { console.log("Bottom sheet closed"); bottomSheetInstance = null; } // Allow re-creation
            });
             // Re-attach listener to the cloned close button if needed, or better:
            const clonedCloseBtn = bottomSheetInstance.sheet.querySelector('#close-bottom-sheet-button');
            if(clonedCloseBtn) clonedCloseBtn.addEventListener('click', () => bottomSheetInstance.close());

        }
        bottomSheetInstance.open();
    });
    if(closeBottomSheetButton) { // Listener for the original button in the template
        closeBottomSheetButton.addEventListener('click', () => {
             if(bottomSheetInstance && bottomSheetInstance.isOpen) bottomSheetInstance.close();
        });
    }

    // AdwToolbarView programmatic toggle (already has inline onclick for demo)
    const myToolbarView = document.getElementById('my-toolbar-view');
    if (myToolbarView) {
        // Example: myToolbarView.hideTopBar();
    }

    // AdwCarousel programmatic control (already has inline onclick for demo)
    const myCarousel = document.getElementById('my-carousel');
    if (myCarousel) {
        myCarousel.addEventListener('slide-changed', e => console.log('Carousel slide changed:', e.detail.currentIndex));
    }

    // AdwToggleGroup value display
    const tg1 = document.getElementById('tg1');
    const tg1ValueSpan = document.getElementById('tg1-value');
    if(tg1 && tg1ValueSpan) {
        tg1ValueSpan.textContent = tg1.value;
        tg1.addEventListener('active-changed', (e) => {
            tg1ValueSpan.textContent = e.detail.value;
            console.log('ToggleGroup 1 changed:', e.detail.value);
        });
    }
    const tg2 = document.getElementById('tg2');
    const tg2ValueSpan = document.getElementById('tg2-value');
     if(tg2 && tg2ValueSpan) {
        tg2ValueSpan.textContent = tg2.value;
        tg2.addEventListener('active-changed', (e) => {
            tg2ValueSpan.textContent = e.detail.value;
            console.log('ToggleGroup 2 changed:', e.detail.value);
        });
    }

    // AdwNavigationSplitView & AdwOverlaySplitView programmatic control (already has inline onclick for demo)
    const myNavSplitView = document.getElementById('my-nav-split-view');
    if(myNavSplitView) {
        myNavSplitView.addEventListener('sidebar-toggled', e => console.log('NavSplitView toggled:', e.detail));
    }
    const myOverlaySplitView = document.getElementById('my-overlay-split-view');
    if(myOverlaySplitView) {
        myOverlaySplitView.addEventListener('sidebar-toggled', e => console.log('OverlaySplitView toggled:', e.detail));
    }

    // Accent color selector
    const accentSelector = document.getElementById('accent-color-selector');
    Adw.getAccentColors().forEach(color => {
        const option = document.createElement('option');
        option.value = color.name;
        option.textContent = color.name.charAt(0).toUpperCase() + color.name.slice(1) + (color.name === Adw.DEFAULT_ACCENT_COLOR.name ? " (Default)" : "");
        if (color.name === Adw.DEFAULT_ACCENT_COLOR.name) option.selected = true;
        accentSelector.appendChild(option);
    });


    // Ensure BreakpointBin initializes correctly after DOM is ready
    // For Web Components, connectedCallback usually handles this.
    // If factory was used, manual trigger might be needed.
    // Our AdwBreakpointBin WC handles this.

    </script>
</body>
</html>
