{% extends "base.html" %}
{% block title %}Login{% endblock %}

{% block content %}
<div style="display: flex; justify-content: center; align-items: center; min-height: 70vh; padding-top: var(--spacing-xxl); padding-bottom: var(--spacing-xxl);">
  <div style="width: 400px; display: flex; flex-direction: column; gap: var(--spacing-lg);"> {# Outer container for centering and width, with gap for button spacing #}
    <h2 style="text-align: center; font-size: var(--font-size-h1);">Login</h2>

    {# Flashed messages will be handled by base.html's script #}
    {% with messages = get_flashed_messages(with_categories=true) %}
      {# This block itself doesn't render anything visible here #}
    {% endwith %}

    <form method="POST" action="{{ url_for('login') }}" style="display: contents;"> {# Use display:contents for form if it's just a wrapper for list-box and button #}
      {{ form.hidden_tag() }} {# CSRF token #}

      <div>
        <label for="username-entry" class="adw-label" style="display: block; margin-bottom: var(--spacing-xxs);">Username</label>
        <adw-entry id="username-entry" name="username" required
                   value="{{ form.username.data if form and form.username.data is not none else request.form.username or '' }}"
                   placeholder="Your Username" style="width: 100%;">
        </adw-entry>
      </div>

      <div>
        <label for="password-entry" class="adw-label" style="display: block; margin-bottom: var(--spacing-xxs); margin-top: var(--spacing-s);">Password</label>
        <adw-entry id="password-entry" name="password" type="password" required
                   placeholder="Your Password" style="width: 100%;">
        </adw-entry>
      </div>

      <adw-button
        suggested
        type="submit"
        style="width: 100%; padding: var(--spacing-sm) 0; font-size: var(--font-size-lg); margin-top: var(--spacing-l);">
        Login
      </adw-button>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const usernameEntry = document.getElementById('username-entry');
    const passwordEntry = document.getElementById('password-entry');
    const submitButton = form.querySelector('adw-button[type="submit"]');

    if (!form || !usernameEntry || !passwordEntry || !submitButton) {
        console.error('[Debug] Login form elements not found for Enter key handler.');
        return;
    }

    console.log('[Debug] Attaching Enter key listeners to login fields.');

    const handleEnterKey = (event) => {
        if (event.key === 'Enter') {
            console.log('[Debug] Enter key pressed in an input field.');
            event.preventDefault(); // Prevent any default action just in case
            // Check if the button's shadowRoot and its internal button exist
            if (submitButton.shadowRoot && submitButton.shadowRoot.querySelector('button')) {
                 console.log('[Debug] Triggering click on internal shadow DOM button.');
                 submitButton.shadowRoot.querySelector('button').click();
            } else {
                 console.log('[Debug] Shadow DOM button not found, attempting click on adw-button itself.');
                 submitButton.click(); // Fallback to clicking the custom element
            }
        }
    };

    usernameEntry.addEventListener('keydown', handleEnterKey);
    passwordEntry.addEventListener('keydown', handleEnterKey);
});
</script>
{% endblock %}
