{% extends "base.html" %}

{% block title %}My Posts - Dashboard{% endblock %}

{% block content %}
<div class="adw-preferences-page" role="main"> {# Using preferences-page for consistent page styling #}
    <header class="adw-preferences-page__header">
        <h1 class="adw-preferences-page__title">My Posts Dashboard</h1>
    </header>

    {% if user_posts %}
    <div class="adw-list-box">
        {% for post in user_posts %}
        <div class="adw-action-row blog-post-dashboard-item">
            <div class="adw-action-row-content" style="display: flex; flex-direction: column; gap: var(--spacing-xxs);">
                <h3 class="adw-action-row-title" style="font-size: var(--font-size-large);">{{ post.title }}</h3>
                <div class="adw-action-row-subtitle">
                    Status:
                    {% if post.is_published %}
                        <span style="color: var(--success-color);">Published</span>
                        {% if post.published_at %} (on <time datetime="{{ post.published_at.isoformat() }}">{{ post.published_at.strftime('%Y-%m-%d') }}</time>){% endif %}
                    {% else %}
                        <span style="color: var(--warning-fg-color);">Draft</span>
                    {% endif %}
                    <br>
                    Last updated: <time datetime="{{ post.updated_at.isoformat() }}">{{ post.updated_at.strftime('%Y-%m-%d %H:%M') }} UTC</time>
                </div>
            </div>
            <div class="adw-action-row-suffix adw-box adw-box-spacing-s" style="align-items: center;">
                <a href="{{ url_for('view_post', post_id=post.id) }}" class="adw-button flat">View</a>
                <a href="{{ url_for('edit_post', post_id=post.id) }}" class="adw-button">Edit</a>
                {# For delete, using a direct form submission per row to use the existing POST route #}
                <form method="POST" action="{{ url_for('delete_post', post_id=post.id) }}" class="inline-form" onsubmit="return confirm('Are you sure you want to delete this post? \\n\\n\'{{ post.title|escapejs }}\'');">
                    {{ csrf_token() }} {# Important: Include CSRF token if your forms generally need it #}
                    <button type="submit" class="adw-button destructive-action">Delete</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="adw-status-page">
        <span class="adw-icon icon-actions-document-new-symbolic adw-status-page-icon" style="font-size: 3rem;"></span>
        <h2 class="adw-status-page-title">No Posts Yet</h2>
        <p class="adw-status-page-description">You haven't created any posts. Why not start now?</p>
        <div class="adw-status-page-actions">
            <a href="{{ url_for('create_post') }}" class="adw-button suggested-action">Create Your First Post</a>
        </div>
    </div>
    {% endif %}
</div>

<style>
/* Simple style for inline form */
.inline-form {
    display: inline; /* Allows button to sit alongside other buttons naturally */
}
.blog-post-dashboard-item .adw-action-row-subtitle {
    font-size: var(--font-size-small);
    line-height: 1.4;
}
</style>
{% endblock %}
