<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{% block title %}My Libadwaita Blog{% endblock %}</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/adwaita-skin.css') }}">
    {# Any app-specific custom styles could go into a separate file if needed #}
    {# e.g., <link rel="stylesheet" href="{{ url_for('static', filename='css/app-demo-custom.css') }}"> #}
</head>
<body>
  <script>
    (function() {
      const theme = "{% if current_user and current_user.is_authenticated and current_user.theme %}{{ current_user.theme }}{% else %}system{% endif %}"; // Default to system
      const accent = "{% if current_user and current_user.is_authenticated and current_user.accent_color %}{{ current_user.accent_color }}{% else %}default{% endif %}";

      let effectiveTheme = theme;
      if (theme === 'system') {
        effectiveTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      }

      if (effectiveTheme === 'dark') {
        document.documentElement.classList.add('theme-dark');
        document.documentElement.classList.remove('theme-light');
      } else {
        document.documentElement.classList.add('theme-light');
        document.documentElement.classList.remove('theme-dark');
      }

      // For accent colors, Adwaita CSS typically handles this via body classes like accent-blue, accent-green etc.
      // The following is a conceptual way to apply it if the CSS is structured for it.
      // Ensure your adwaita-skin.css has rules for .accent-blue, .accent-red etc. on body or html.
      const validAccents = ['blue', 'green', 'yellow', 'orange', 'red', 'purple', 'brown']; // Example list
      if (accent !== 'default' && validAccents.includes(accent)) {
        document.documentElement.classList.forEach(cls => {
          if (cls.startsWith('accent-')) {
            document.documentElement.classList.remove(cls);
          }
        });
        document.documentElement.classList.add(`accent-${accent}`);
      }
    })();
  </script>

    <header class="adw-header-bar">
        <div class="adw-header-bar__start">
            {# <a href="{{ url_for('index') }}" class="adw-button icon-only" title="Home">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8.5 1.5A1.5 1.5 0 0 0 7 0H1.5A1.5 1.5 0 0 0 0 1.5v13A1.5 1.5 0 0 0 1.5 16h13a1.5 1.5 0 0 0 1.5-1.5v-13A1.5 1.5 0 0 0 14.5 0H9a1.5 1.5 0 0 0-1.5 1.5H8.5zM8 15H1.5a.5.5 0 0 1-.5-.5V1.5a.5.5 0 0 1 .5-.5H7V.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 .5.5v13a.5.5 0 0 1-.5.5H8zM5 5.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1H5.5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1H5.5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1H5.5a.5.5 0 0 1-.5-.5z"/></svg>
            </a> #}
            <h1 class="adw-header-bar__title">Blog Demo</h1>
        </div>
        <div class="adw-header-bar__center">
             <a href="{{ url_for('index') }}" class="adw-button flat">Home</a>
             <a href="{{ url_for('about_page') }}" class="adw-button flat">About</a>
             <a href="{{ url_for('contact_page') }}" class="adw-button flat">Contact</a>
        </div>
        <div class="adw-header-bar__end">
            <form action="{{ url_for('search_results') }}" method="GET" style="display: flex; align-items: center; gap: var(--spacing-xs);">
                <input type="search" name="q" placeholder="Search..." value="{{ request.args.get('q', '') }}" class="adw-entry" style="min-width: 150px;">
                {# <button type="submit" class="adw-button icon-only flat" aria-label="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
                    </svg>
                </button> #}
            </form>
        {% if current_user.is_authenticated %}
            <a href="{{ url_for('create_post') }}" class="adw-button suggested-action">New Post</a>
            <a href="{{ url_for('profile', username=current_user.username) }}" class="adw-button flat circular" title="View Profile" style="padding: var(--spacing-xxs); margin-left: var(--spacing-xs);">
                {% if current_user.profile_photo_url %}
                    <span class="adw-avatar size-small">
                        <img src="{{ url_for('static', filename=current_user.profile_photo_url) }}" alt="Avatar">
                    </span>
                {% else %}
                    <span class="adw-avatar size-small">
                        <span class="adw-avatar-text">
                            {% set name_parts = current_user.username.split() %}
                            {{ name_parts[0][0]|upper if (name_parts|length >= 1 and name_parts[0]) else 'U' }}
                        </span>
                    </span>
                {% endif %}
            </a>
            <a href="{{ url_for('settings_page') }}" class="adw-button flat" title="Settings">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear-fill" viewBox="0 0 16 16"><path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311a1.464 1.464 0 0 1 .872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1-.872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1-.872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1 .872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/></svg>
            </a>
            <a href="{{ url_for('logout') }}" class="adw-button flat">Logout</a>
        {% else %}
            <a href="{{ url_for('login') }}" class="adw-button">Login</a>
        {% endif %}
        </div>
    </header>
    <main class="adw-page">
        {# Removed flash-banner-container as it wasn't being used by pure CSS approach #}
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div id="manual-flash-messages" style="position: sticky; top: var(--spacing-s); z-index: 1050; padding: 0 var(--spacing-xl) var(--spacing-m);">
              {% for category, message in messages %}
                {% set category_class = 'flash-message-' ~ (category if category != 'message' else 'info') %}
                <div class="flash-message-base {{ category_class }}" role="alert">
                  {{ message }}
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <div class="main-content-clamped">
            {% block content %}{% endblock %}
        </div>
    </main>
    {% block scripts %}{% endblock %}
</body>
</html>
