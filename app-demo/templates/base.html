<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{% block title %}My Libadwaita Blog{% endblock %}</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/adwaita-skin.css') }}">
</head>
<body>
  <script>
    (function() {
      const theme = "{% if current_user and current_user.is_authenticated and current_user.theme %}{{ current_user.theme }}{% else %}system{% endif %}"; // Default to system
      const accent = "{% if current_user and current_user.is_authenticated and current_user.accent_color %}{{ current_user.accent_color }}{% else %}default{% endif %}";

      let effectiveTheme = theme;
      if (theme === 'system') {
        effectiveTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      }

      if (effectiveTheme === 'dark') {
        document.documentElement.classList.add('theme-dark');
        document.documentElement.classList.remove('theme-light');
      } else {
        document.documentElement.classList.add('theme-light');
        document.documentElement.classList.remove('theme-dark');
      }

      // For accent colors, Adwaita CSS typically handles this via body classes like accent-blue, accent-green etc.
      // The following is a conceptual way to apply it if the CSS is structured for it.
      // Ensure your adwaita-skin.css has rules for .accent-blue, .accent-red etc. on body or html.
      const validAccents = ['default', 'blue', 'green', 'yellow', 'orange', 'red', 'purple', 'pink']; // Updated list
      let accentClassFound = false;
      document.documentElement.classList.forEach(cls => {
        if (cls.startsWith('accent-')) {
          if (cls === `accent-${accent}`) {
            accentClassFound = true; // Current accent is already set
          } else {
            document.documentElement.classList.remove(cls); // Remove other accent classes
          }
        }
      });

      if (accent !== 'default' && validAccents.includes(accent) && !accentClassFound) {
        document.documentElement.classList.add(`accent-${accent}`);
      } else if (accent === 'default') {
        // All non-default accent classes should have been removed by the loop above.
        // The base :root styles (which default to blue) will apply.
      }
    })();
  </script>

<header class="adw-header-bar">
    <div class="adw-header-bar__start">
        <a href="{{ url_for('index') }}" class="adw-header-bar__title site-title-link">Blog Demo</a>
    </div>
    <div class="adw-header-bar__center">
        {# Optionally, a view-specific title could be injected here using a block #}
        {% block header_title %}{% endblock %}
    </div>
    <div class="adw-header-bar__end">
        {% block header_actions_start %}{% endblock %} {# For buttons like "Edit Profile" #}
        <form action="{{ url_for('search_results') }}" method="GET" class="header-search-form">
            <input type="search" name="q" placeholder="Search..." value="{{ request.args.get('q', '') }}" class="adw-entry">
            <button type="submit" class="adw-button flat circular" aria-label="Search">
                <span class="adw-icon icon-actions-system-search-symbolic"></span>
            </button>
        </form>

        {% if current_user.is_authenticated %}
            <a href="{{ url_for('create_post') }}" class="adw-button suggested-action">New Post</a>

            <a href="{{ url_for('profile', username=current_user.username) }}" class="adw-button flat circular profile-avatar-button" title="View Profile">
                {% if current_user.profile_photo_url %}
                    <span class="adw-avatar size-small">
                        <img src="{{ url_for('static', filename=current_user.profile_photo_url) }}" alt="Avatar">
                    </span>
                {% else %}
                    <span class="adw-avatar size-small">
                        <span class="adw-avatar-text">
                            {{ current_user.username[0]|upper if current_user.username else 'U' }}
                        </span>
                    </span>
                {% endif %}
            </a>
            <a href="{{ url_for('dashboard') }}" class="adw-button flat" title="My Posts">Dashboard</a>
            <a href="{{ url_for('settings_page') }}" class="adw-button flat" title="Settings">Settings</a>
            <a href="{{ url_for('logout') }}" class="adw-button flat">Logout</a>
        {% else %}
            {# About and Contact are moved to footer for logged-out users too for consistency #}
            <a href="{{ url_for('login') }}" class="adw-button">Login</a>
        {% endif %}
    </div>
</header>

    <div class="page-content-wrapper"> {# Replaced adw-page for more control #}
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-messages-container" style="position: sticky; top: 0; z-index: 1050; padding: 0 var(--spacing-m) var(--spacing-s);">
              {% for category, message in messages %}
                {% set banner_class = 'adw-banner' %}
                {% if category == 'error' %}
                  {% set banner_class = banner_class ~ ' adw-banner-error' %}
                {% elif category == 'success' %}
                  {% set banner_class = banner_class ~ ' adw-banner-success' %}
                {# Default 'info' or 'message' categories will use the base .adw-banner style #}
                {% endif %}
                <div class="{{ banner_class }} visible" role="alert" style="position: relative; top: auto; left: auto; right: auto; transform: none; opacity: 1; margin-top: var(--spacing-s);">
                  <span class="adw-banner-title">{{ message }}</span>
                  {# Optionally add a close button here that JS can hide #}
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <main class="adw-clamp main-content"> {# Use adw-clamp for content width control #}
            {% block content %}{% endblock %}
        </main>
    </div>

    <footer class="app-footer adw-toolbar">
        <div class="adw-toolbar__start">
            <span class="adw-label caption">&copy; {{ current_year }} Blog Demo.</span>
        </div>
        <div class="adw-toolbar__center">
            {# Optional: social links or other footer content #}
        </div>
        <div class="adw-toolbar__end">
            <a href="{{ url_for('about_page') }}" class="adw-button flat">About</a>
            <a href="{{ url_for('contact_page') }}" class="adw-button flat">Contact</a>
        </div>
    </footer>

    {% block scripts %}{% endblock %}
</body>
</html>
