{% extends "base.html" %}

{% block title %}
    {% if query %}Search Results for '{{ query }}'{% else %}Search Posts{% endif %} - {{ super() }}
{% endblock %}

{% block headerbar %}
<adw-header-bar>
    <adw-window-title slot="title" title="{% if query %}Results for '{{ query }}'{% else %}Search Posts{% endif %}"></adw-window-title>
    <adw-button slot="start" icon-name="go-previous-symbolic" href="{{ url_for('index') }}" aria-label="Back to Home"></adw-button>
</adw-header-bar>
{% endblock %}

{% block content %}
<adw-clamp class="adw-clamp-xl" style="padding-top: var(--spacing-l);">
    <adw-box orientation="vertical" spacing="l">

        <div style="text-align: center; margin-bottom: var(--spacing-m);">
          <adw-spinner id="search-loading-spinner" size="l" style="display: none;"></adw-spinner>
        </div>

        {% if posts %}
            <adw-list-box class="blog-posts-list" selectable>
                {% for post in posts %}
                {# Using adw-expander-row for a card-like appearance, non-expandable but with title/subtitle and content area #}
                {# Or a custom styled adw-box could be used if adw-expander-row is not fitting #}
                <adw-action-row href="{{ url_for('view_post', post_id=post.id) }}" activatable class="card-like-row">
                    <div slot="prefix">
                        {# Optionally, an icon or avatar could go here #}
                    </div>
                    <span slot="title">{{ post.title }}</span>
                    <span slot="subtitle">
                        By: <a href="{{ url_for('profile', username=post.author.username) }}" class="adw-link">{{ post.author.username if post.author else 'Unknown Author' }}</a>
                        on <time datetime="{{ post.created_at.isoformat() }}">{{ post.created_at.strftime('%Y-%m-%d') if post.created_at else 'Unknown date' }}</time>
                        <br>
                        {{ post.content | striptags | truncate(150, True) }}
                    </span>
                    {# Suffix slot could be used for 'Read More' or other actions, but direct navigation is fine for action row #}
                </adw-action-row>

                {# For categories and tags, they might be better placed inside the post view, or styled differently here #}
                {# If keeping them, simple adw-box with adw-buttons: #}
                {% if post.categories or post.tags %}
                <adw-box orientation="vertical" spacing="s" style="padding-left: var(--spacing-xxl); padding-right: var(--spacing-m); padding-bottom: var(--spacing-m);">
                    {% if post.categories %}
                    <adw-box orientation="horizontal" spacing="xs" align="center" class="wrap-box">
                        <adw-label is-caption style="font-weight: bold;">Categories:</adw-label>
                        {% for category in post.categories %}
                            <adw-button text="{{ category.name }}" href="{{ url_for('posts_by_category', category_slug=category.slug) }}" flat class="tag-button"></adw-button>
                        {% endfor %}
                    </adw-box>
                    {% endif %}
                    {% if post.tags %}
                    <adw-box orientation="horizontal" spacing="xs" align="center" class="wrap-box">
                        <adw-label is-caption style="font-weight: bold;">Tags:</adw-label>
                        {% for tag_item in post.tags %}
                          <adw-button text="{{ tag_item.name }}" href="{{ url_for('posts_by_tag', tag_slug=tag_item.slug) }}" flat class="tag-button"></adw-button>
                        {% endfor %}
                    </adw-box>
                    {% endif %}
                </adw-box>
                {% endif %}

                {% endfor %}
            </adw-list-box>

            {% if pagination and pagination.pages > 1 %}
            <adw-box orientation="horizontal" justify="center" style="margin-top: var(--spacing-l);">
                <adw-toggle-group>
                    {% if pagination.has_prev %}
                        <adw-button icon-name="go-previous-symbolic" href="{{ url_for('search_results', q=query, page=pagination.prev_num) }}"></adw-button>
                    {% else %}
                        <adw-button icon-name="go-previous-symbolic" disabled></adw-button>
                    {% endif %}

                    {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                        {% if page_num %}
                            {% if page_num == pagination.page %}
                                <adw-button text="{{ page_num }}" suggested disabled aria-current="page"></adw-button>
                            {% else %}
                                <adw-button text="{{ page_num }}" href="{{ url_for('search_results', q=query, page=page_num) }}"></adw-button>
                            {% endif %}
                        {% elif loop.index != 1 and loop.index != pagination.pages + 2 %}
                            <adw-button text="â€¦" flat disabled style="pointer-events: none;"></adw-button>
                        {% endif %}
                    {% endfor %}

                    {% if pagination.has_next %}
                        <adw-button icon-name="go-next-symbolic" href="{{ url_for('search_results', q=query, page=pagination.next_num) }}"></adw-button>
                    {% else %}
                        <adw-button icon-name="go-next-symbolic" disabled></adw-button>
                    {% endif %}
                </adw-toggle-group>
            </adw-box>
            {% endif %}
        {% elif query %}
            <adw-status-page icon-name="system-search-symbolic" title="No Results Found" description="Sorry, no posts matched your search for '{{ query }}'. Try using different keywords.">
                <adw-button slot="actions" text="Browse All Posts" href="{{ url_for('index') }}" suggested></adw-button>
            </adw-status-page>
        {% else %}
            <adw-status-page icon-name="edit-find-symbolic" title="Search Posts" description="Please enter a term in the search bar above to find posts.">
                 <adw-button slot="actions" text="Back to All Posts" href="{{ url_for('index') }}"></adw-button>
            </adw-status-page>
        {% endif %}
    </adw-box>
</adw-clamp>

<style>
/* Custom styling for card-like rows if needed, and tag buttons */
.card-like-row {
    /* You might not need this if adw-action-row default styling is sufficient */
    /* Or add custom properties here */
}
.tag-button {
    /* font-size: var(--font-size-caption); */ /* Handled by adw-button flat */
    /* padding: var(--spacing-xxs) var(--spacing-xs); */ /* Handled by adw-button flat */
}
.wrap-box {
    flex-wrap: wrap;
}
</style>
{% endblock %}
