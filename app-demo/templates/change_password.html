{% extends "base.html" %}

{% block title %}Change Password{% endblock %}

{% block content %}
<div style="display: flex; justify-content: center; align-items: center; min-height: 70vh; padding: var(--spacing-xxl) 0;">
  <div style="width: 500px; display: flex; flex-direction: column; gap: var(--spacing-lg);">
    <h2 style="text-align: center; font-size: var(--font-size-xxl);">Change Password</h2>

    {# Flashed messages will be handled by base.html's script which creates toasts/banners #}
    {% with messages = get_flashed_messages(with_categories=true) %}
      {# This block itself doesn't render anything visible here, but makes messages available #}
    {% endwith %}

    <form method="POST" action="{{ url_for('change_password_page') }}" style="display: flex; flex-direction: column; gap: var(--spacing-lg);">
      {{ form.hidden_tag() }} {# CSRF token #}

      <adw-preferences-group title="Update Your Password">
        <adw-password-entry-row
          title="{{ form.current_password.label.text }}"
          name="{{ form.current_password.name }}"
          id="{{ form.current_password.id or 'current_password' }}"
          required
          value="{{ form.current_password.data or '' }}" {# Pre-fill if needed, though unlikely for password change #}
          subtitle="{{ form.current_password.errors|join(' ') if form.current_password.errors else '' }}"
          class="{{ 'has-error' if form.current_password.errors else '' }}">
          {# This component should render its own input. We pass WTForm's name and id. #}
          {# We don't render {{ form.current_password() }} directly if adw-password-entry-row is self-contained #}
        </adw-password-entry-row>

        <adw-password-entry-row
          title="{{ form.new_password.label.text }}"
          name="{{ form.new_password.name }}"
          id="{{ form.new_password.id or 'new_password' }}"
          required
          subtitle="{{ form.new_password.errors|join(' ') if form.new_password.errors else 'Minimum 8 characters.' }}"
          class="{{ 'has-error' if form.new_password.errors else '' }}">
        </adw-password-entry-row>

        <adw-password-entry-row
          title="{{ form.confirm_new_password.label.text }}"
          name="{{ form.confirm_new_password.name }}"
          id="{{ form.confirm_new_password.id or 'confirm_new_password' }}"
          required
          subtitle="{{ form.confirm_new_password.errors|join(' ') if form.confirm_new_password.errors else '' }}"
          class="{{ 'has-error' if form.confirm_new_password.errors else '' }}">
        </adw-password-entry-row>
      </adw-preferences-group>

      <adw-action-row> {# Using adw-action-row for buttons consistent with preferences patterns #}
          <div slot="suffix" style="display: flex; gap: var(--spacing-s); justify-content: flex-end; width: 100%;">
              <adw-button flat href="{{ url_for('settings_page') }}">Cancel</adw-button>
              {# Use WTForms to render the submit button's label for consistency, but use adw-button tag #}
              <adw-button type="submit" suggested>{{ form.submit.label.text }}</adw-button>
          </div>
      </adw-action-row>
    </form>
  </div>
</div>
{% endblock %}
