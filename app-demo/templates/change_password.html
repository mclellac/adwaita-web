{% extends "base.html" %}

{% block title %}Change Password{% endblock %}

{% block content %}
<div style="display: flex; justify-content: center; align-items: center; min-height: 70vh; padding: var(--spacing-xxl) 0;">
  <div style="width: 500px; display: flex; flex-direction: column; gap: var(--spacing-lg);">
    <h2 style="text-align: center; font-size: var(--font-size-xxl);">Change Password</h2>

    {# Flashed messages will be handled by base.html's script which creates toasts/banners #}
    {% with messages = get_flashed_messages(with_categories=true) %}
      {# This block itself doesn't render anything visible here, but makes messages available #}
    {% endwith %}

    <form method="POST" action="{{ url_for('change_password_page') }}" style="display: flex; flex-direction: column; gap: var(--spacing-lg);">
      {{ form.hidden_tag() }} {# CSRF token #}

      <div class="adw-preferences-group" role="group" aria-labelledby="change-password-group-title">
        <div class="adw-preferences-group__title-container">
            <h3 class="adw-preferences-group__title" id="change-password-group-title">Update Your Password</h3>
        </div>

        {# Current Password Field #}
        <div class="adw-entry-row {{ 'has-error' if form.current_password.errors else '' }}">
          <div class="adw-entry-row-text-content">
            <label for="{{ form.current_password.id or 'current_password_input' }}" class="adw-entry-row-title">{{ form.current_password.label.text }}</label>
            {% if form.current_password.errors %}
              <div class="adw-entry-row-subtitle error-text">{{ form.current_password.errors|join(' ') }}</div>
            {% endif %}
          </div>
          <input type="password"
                 name="{{ form.current_password.name }}"
                 id="{{ form.current_password.id or 'current_password_input' }}"
                 class="adw-entry row-input"
                 required
                 value="{{ form.current_password.data or '' }}">
        </div>

        {# New Password Field #}
        <div class="adw-entry-row {{ 'has-error' if form.new_password.errors else '' }}">
          <div class="adw-entry-row-text-content">
            <label for="{{ form.new_password.id or 'new_password_input' }}" class="adw-entry-row-title">{{ form.new_password.label.text }}</label>
            {% if form.new_password.errors %}
              <div class="adw-entry-row-subtitle error-text">{{ form.new_password.errors|join(' ') }}</div>
            {% else %}
              <div class="adw-entry-row-subtitle">Minimum 8 characters.</div>
            {% endif %}
          </div>
          <input type="password"
                 name="{{ form.new_password.name }}"
                 id="{{ form.new_password.id or 'new_password_input' }}"
                 class="adw-entry row-input"
                 required>
        </div>

        {# Confirm New Password Field #}
        <div class="adw-entry-row {{ 'has-error' if form.confirm_new_password.errors else '' }}">
          <div class="adw-entry-row-text-content">
            <label for="{{ form.confirm_new_password.id or 'confirm_new_password_input' }}" class="adw-entry-row-title">{{ form.confirm_new_password.label.text }}</label>
            {% if form.confirm_new_password.errors %}
              <div class="adw-entry-row-subtitle error-text">{{ form.confirm_new_password.errors|join(' ') }}</div>
            {% endif %}
          </div>
          <input type="password"
                 name="{{ form.confirm_new_password.name }}"
                 id="{{ form.confirm_new_password.id or 'confirm_new_password_input' }}"
                 class="adw-entry row-input"
                 required>
        </div>
      </div>

      <div class="adw-action-row"> {# Retaining adw-action-row for layout if it provides useful padding/alignment #}
          <div class="adw-action-row__suffix-widget" style="display: flex; gap: var(--spacing-s); justify-content: flex-end; width: 100%;">
              <a href="{{ url_for('settings_page') }}" class="adw-button flat">Cancel</a>
              <button type="submit" class="adw-button suggested-action">{{ form.submit.label.text }}</button>
          </div>
      </div>
    </form>
  </div>
</div>
{% endblock %}
