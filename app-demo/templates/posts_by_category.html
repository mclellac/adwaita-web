{% extends "base.html" %}

{% block title %}Posts in {{ category.name }} - {{ super() }}{% endblock %}

{% block headerbar %}
<adw-header-bar>
    <adw-window-title slot="title" title="Category: {{ category.name }}"></adw-window-title>
    <adw-button slot="start" icon-name="go-previous-symbolic" href="{{ url_for('index') }}" aria-label="Back to Home"></adw-button>
</adw-header-bar>
{% endblock %}

{% block content %}
<adw-clamp class="adw-clamp-xl" style="padding-top: var(--spacing-l);">
    <adw-box orientation="vertical" spacing="l">

        <div style="text-align: center; margin-bottom: var(--spacing-m);">
          <adw-spinner id="category-loading-spinner" size="l" style="display: none;"></adw-spinner>
        </div>

        {% if posts %}
            <adw-list-box class="blog-posts-list" selectable>
                {% for post in posts %}
                <adw-action-row href="{{ url_for('view_post', post_id=post.id) }}" activatable class="card-like-row">
                    <span slot="title">{{ post.title }}</span>
                    <span slot="subtitle">
                        By: <a href="{{ url_for('profile', username=post.author.username) }}" class="adw-link">{{ post.author.username if post.author else 'Unknown Author' }}</a>
                        on <time datetime="{{ post.created_at.isoformat() }}">{{ post.created_at.strftime('%Y-%m-%d') if post.created_at else 'Unknown date' }}</time>
                        <br>
                        {{ (post.content | markdown_to_html_and_sanitize | striptags | truncate(150, True)) if post.content else '' }}
                    </span>
                </adw-action-row>
                {% if post.categories or post.tags %}
                <adw-box orientation="vertical" spacing="s" style="padding-left: var(--spacing-xxl); padding-right: var(--spacing-m); padding-bottom: var(--spacing-m);">
                    {% if post.categories %}
                    <adw-box orientation="horizontal" spacing="xs" align="center" class="wrap-box">
                        <adw-label is-caption style="font-weight: bold;">Categories:</adw-label>
                        {% for cat_item in post.categories %}
                            <adw-button text="{{ cat_item.name }}" href="{{ url_for('posts_by_category', category_slug=cat_item.slug) }}" flat class="tag-button"></adw-button>
                        {% endfor %}
                    </adw-box>
                    {% endif %}
                    {% if post.tags %}
                    <adw-box orientation="horizontal" spacing="xs" align="center" class="wrap-box">
                        <adw-label is-caption style="font-weight: bold;">Tags:</adw-label>
                        {% for tag_item in post.tags %}
                          <adw-button text="{{ tag_item.name }}" href="{{ url_for('posts_by_tag', tag_slug=tag_item.slug) }}" flat class="tag-button"></adw-button>
                        {% endfor %}
                    </adw-box>
                    {% endif %}
                </adw-box>
                {% endif %}
                {% endfor %}
            </adw-list-box>

            {% if pagination and pagination.pages > 1 %}
            <adw-box orientation="horizontal" justify="center" style="margin-top: var(--spacing-l);">
                <adw-toggle-group>
                    {% if pagination.has_prev %}
                        <adw-button icon-name="go-previous-symbolic" href="{{ url_for('posts_by_category', category_slug=category.slug, page=pagination.prev_num) }}"></adw-button>
                    {% else %}
                        <adw-button icon-name="go-previous-symbolic" disabled></adw-button>
                    {% endif %}

                    {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                        {% if page_num %}
                            {% if page_num == pagination.page %}
                                <adw-button text="{{ page_num }}" suggested disabled aria-current="page"></adw-button>
                            {% else %}
                                <adw-button text="{{ page_num }}" href="{{ url_for('posts_by_category', category_slug=category.slug, page=page_num) }}"></adw-button>
                            {% endif %}
                        {% elif loop.index != 1 and loop.index != pagination.pages + 2 %}
                            <adw-button text="â€¦" flat disabled style="pointer-events: none;"></adw-button>
                        {% endif %}
                    {% endfor %}

                    {% if pagination.has_next %}
                        <adw-button icon-name="go-next-symbolic" href="{{ url_for('posts_by_category', category_slug=category.slug, page=pagination.next_num) }}"></adw-button>
                    {% else %}
                        <adw-button icon-name="go-next-symbolic" disabled></adw-button>
                    {% endif %}
                </adw-toggle-group>
            </adw-box>
            {% endif %}
        {% else %}
             <adw-status-page icon-name="empty-symbolic" title="No Posts Found" description="There are no posts in the category '{{ category.name }}'.">
                <adw-button slot="actions" text="View All Posts" href="{{ url_for('index') }}"></adw-button>
            </adw-status-page>
        {% endif %}
    </adw-box>
</adw-clamp>

<style>
/* Custom styling for card-like rows if needed, and tag buttons */
.card-like-row {
    /* You might not need this if adw-action-row default styling is sufficient */
}
.tag-button {
    /* font-size: var(--font-size-caption); */
    /* padding: var(--spacing-xxs) var(--spacing-xs); */
}
.wrap-box {
    flex-wrap: wrap;
}
</style>
{% endblock %}
