<<<<<<< SEARCH
{% extends "base.html" %}

{% block title %}Profile: {{ user_profile.username }}{% endblock %}

{% block headerbar %}
<adw-header-bar>
    <adw-window-title slot="title" title="{{ user_profile.username }}'s Profile"></adw-window-title>
    <adw-button slot="start" icon-name="go-previous-symbolic" href="{{ url_for('index') }}" aria-label="Back to Home"></adw-button>
    {% if current_user == user_profile %}
    <adw-button slot="end" text="Edit Profile" href="{{ url_for('edit_profile') }}" suggested></adw-button>
    {% endif %}
</adw-header-bar>
{% endblock %}

{% block content %}
<adw-clamp class="adw-clamp-xl">
    <adw-box orientation="vertical" spacing="l" style="padding-top: var(--spacing-l);">

        {# User Header Info #}
        <adw-box orientation="horizontal" spacing="xl" align="center">
            <adw-avatar image="{{ url_for('static', filename=user_profile.profile_photo_url) if user_profile.profile_photo_url else default_avatar_url }}" text="{{ user_profile.username }}" size="96"></adw-avatar>
            <adw-box orientation="vertical" spacing="xs">
                <adw-label title-level="1">{{ user_profile.full_name or user_profile.username }}</adw-label>
                {% if user_profile.full_name %}
                <adw-label is-caption>@{{ user_profile.username }}</adw-label>
                {% endif %}
            </adw-box>
        </adw-box>

        {# Profile Details Group #}
        <adw-preferences-group title="About {{user_profile.username}}">
            {% if user_profile.profile_info %}
            <adw-expander-row title="Bio" subtitle="View user's biography">
                <div style="padding: var(--spacing-m); white-space: pre-wrap;">
                    {{ user_profile.profile_info | safe }}
                </div>
            </adw-expander-row>
            {% else %}
            <adw-action-row title="Bio" subtitle="No bio provided."></adw-action-row>
            {% endif %}

            {% if user_profile.location %}
            <adw-action-row title="Location" subtitle="{{ user_profile.location }}"></adw-action-row>
            {% endif %}

            {% if user_profile.website_url %}
                {% if user_profile.website_url.startswith('http://') or user_profile.website_url.startswith('https://') %}
                <adw-action-row title="Website" subtitle="{{ user_profile.website_url }}" href="{{ user_profile.website_url }}" target="_blank" activatable></adw-action-row>
                {% else %}
                <adw-action-row title="Website" subtitle="{{ user_profile.website_url }} (Not a valid link)"></adw-action-row>
                {% endif %}
            {% endif %}

            {% if current_user == user_profile %}
            <adw-action-row title="Profile Privacy" subtitle="{{ 'Public' if user_profile.is_profile_public else 'Private (Only you can see full details)' }}"></adw-action-row>
            {% endif %}
        </adw-preferences-group>

        {# User Posts Section #}
        <adw-preferences-group title="Posts by {{ user_profile.username }}">
            {% if posts_pagination and posts_pagination.items %}
                <adw-list-box selectable>
                    {% for post in posts_pagination.items %}
                    <adw-action-row href="{{ url_for('view_post', post_id=post.id) }}" title="{{ post.title }}{% if not post.is_published and current_user == post.author %} (Draft){% endif %}" subtitle="{% if post.is_published and post.published_at %}Published: {{ post.published_at.strftime('%Y-%m-%d %H:%M') }} UTC{% elif not post.is_published %}Draft - Last updated: {{ post.updated_at.strftime('%Y-%m-%d %H:%M') }} UTC{% else %}Created: {{ post.created_at.strftime('%Y-%m-%d %H:%M') }} UTC{% endif %}" activatable></adw-action-row>
                    {% endfor %}
                </adw-list-box>

                {# Pagination Controls - Using Adwaita ToggleGroup for a more native feel #}
                {% if posts_pagination.pages > 1 %}
                <adw-box orientation="horizontal" justify="center" style="margin-top: var(--spacing-l);">
                    <adw-toggle-group>
                        {% if posts_pagination.has_prev %}
                            <adw-button icon-name="go-previous-symbolic" href="{{ url_for('profile', username=user_profile.username, page=posts_pagination.prev_num) }}"></adw-button>
                        {% else %}
                            <adw-button icon-name="go-previous-symbolic" disabled></adw-button>
                        {% endif %}

                        {% for page_num in posts_pagination.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                            {% if page_num %}
                                {% if page_num == posts_pagination.page %}
                                    <adw-button text="{{ page_num }}" suggested disabled aria-current="page"></adw-button>
                                {% else %}
                                    <adw-button text="{{ page_num }}" href="{{ url_for('profile', username=user_profile.username, page=page_num) }}"></adw-button>
                                {% endif %}
                            {% elif loop.index != 1 and loop.index != posts_pagination.pages + 2 %} {# Avoid ellipsis at very start/end if not needed #}
                                <adw-button text="…" flat disabled style="pointer-events: none;"></adw-button>
                            {% endif %}
                        {% endfor %}

                        {% if posts_pagination.has_next %}
                            <adw-button icon-name="go-next-symbolic" href="{{ url_for('profile', username=user_profile.username, page=posts_pagination.next_num) }}"></adw-button>
                        {% else %}
                            <adw-button icon-name="go-next-symbolic" disabled></adw-button>
                        {% endif %}
                    </adw-toggle-group>
                </adw-box>
                {% endif %}
            {% else %}
                <adw-status-page icon-name="document-new-symbolic" title="No Posts Yet" description="{{ user_profile.username }} has not made any posts.">
                </adw-status-page>
            {% endif %}
        </adw-preferences-group>
    </adw-box>
</adw-clamp>
{% endblock %}
=======
{% extends "base.html" %}

{% block title %}Profile: {{ user_profile.username }}{% endblock %}

{# Note: The headerbar for profile page might be better defined in base.html if it's consistent,
   or keep it here if it's truly unique to this page.
   For this refactor, we assume the header bar defined in base.html is the primary one.
   This block can override or supplement parts of the base.html header if needed.
   If base.html already has a complete header bar, this block might not be strictly necessary
   unless we want to add profile-specific actions *into* the base header structure.

   Let's assume `base.html` provides the main `<header class="adw-header-bar">`
   and we want to inject profile-specific elements into its start/end slots.
   However, `base.html` currently defines its own complete header bar.
   For simplicity, we will override the headerbar block entirely here for now,
   but this could be integrated more deeply with `base.html`'s header structure if desired.
#}
{% block headerbar %}
<header class="adw-header-bar">
    <div class="adw-header-bar__start">
        <a href="{{ url_for('index') }}" class="adw-button circular flat" aria-label="Back to Home" title="Back to Home">
            <span class="adw-icon icon-go-previous-symbolic"></span>
        </a>
    </div>
    <div class="adw-header-bar__center">
        <h1 class="adw-header-bar__title">{{ user_profile.username }}'s Profile</h1>
    </div>
    <div class="adw-header-bar__end">
        {% if current_user == user_profile %}
        <a href="{{ url_for('edit_profile') }}" class="adw-button suggested-action">Edit Profile</a>
        {% endif %}
    </div>
</header>
{% endblock %}

{% block content %}
<div class="adw-clamp adw-clamp-xl" style="padding-top: var(--spacing-l); padding-bottom: var(--spacing-l);">
    <div class="adw-box adw-box-vertical" style="gap: var(--spacing-l);">

        {# User Header Info #}
        <div class="adw-box" style="gap: var(--spacing-xl); align-items: center;">
            <span class="adw-avatar size-huge">
                {% if user_profile.profile_photo_url %}
                <img src="{{ url_for('static', filename=user_profile.profile_photo_url) }}" alt="{{ user_profile.username }}'s Avatar">
                {% else %}
                <span class="adw-avatar-text">
                    {% set name_parts = user_profile.username.split() %}
                    {{ name_parts[0][0]|upper if (name_parts|length >= 1 and name_parts[0]) else 'U' }}
                </span>
                {% endif %}
            </span>
            <div class="adw-box adw-box-vertical" style="gap: var(--spacing-xs);">
                <h1 class="adw-label" style="font-size: var(--font-size-h1);">{{ user_profile.full_name or user_profile.username }}</h1>
                {% if user_profile.full_name %}
                <p class="adw-label" style="font-size: var(--font-size-large); opacity: 0.7;">@{{ user_profile.username }}</p>
                {% endif %}
            </div>
        </div>

        {# Profile Details Group #}
        <section class="adw-preferences-group">
            <h2 class="adw-preferences-group__title">About {{user_profile.username}}</h2>
            <div class="adw-list-box">
                {% if user_profile.profile_info %}
                {# AdwExpanderRow is complex to replicate purely with CSS + minimal HTML.
                   For now, showing content directly or simplifying.
                   A true expander would require JS or <details> element.
                #}
                <div class="adw-action-row">
                    <div class="adw-action-row__text">
                        <span class="adw-action-row__title">Bio</span>
                        <span class="adw-action-row__subtitle">View user's biography</span>
                    </div>
                </div>
                <div style="padding: var(--spacing-m); white-space: pre-wrap; border-top: 1px solid var(--border-color);">
                    {{ user_profile.profile_info | safe }}
                </div>
                {% else %}
                <div class="adw-action-row">
                    <div class="adw-action-row__text">
                        <span class="adw-action-row__title">Bio</span>
                        <span class="adw-action-row__subtitle">No bio provided.</span>
                    </div>
                </div>
                {% endif %}

                {% if user_profile.location %}
                <div class="adw-action-row">
                    <div class="adw-action-row__text">
                        <span class="adw-action-row__title">Location</span>
                        <span class="adw-action-row__subtitle">{{ user_profile.location }}</span>
                    </div>
                </div>
                {% endif %}

                {% if user_profile.website_url %}
                    {% if user_profile.website_url.startswith('http://') or user_profile.website_url.startswith('https://') %}
                    <a href="{{ user_profile.website_url }}" target="_blank" class="adw-action-row activatable">
                        <div class="adw-action-row__text">
                            <span class="adw-action-row__title">Website</span>
                            <span class="adw-action-row__subtitle">{{ user_profile.website_url }}</span>
                        </div>
                        <span class="adw-action-row__chevron adw-icon icon-go-next-symbolic"></span>
                    </a>
                    {% else %}
                    <div class="adw-action-row">
                        <div class="adw-action-row__text">
                            <span class="adw-action-row__title">Website</span>
                            <span class="adw-action-row__subtitle">{{ user_profile.website_url }} (Not a valid link)</span>
                        </div>
                    </div>
                    {% endif %}
                {% endif %}

                {% if current_user == user_profile %}
                <div class="adw-action-row">
                    <div class="adw-action-row__text">
                        <span class="adw-action-row__title">Profile Privacy</span>
                        <span class="adw-action-row__subtitle">{{ 'Public' if user_profile.is_profile_public else 'Private (Only you can see full details)' }}</span>
                    </div>
                </div>
                {% endif %}
            </div>
        </section>

        {# User Posts Section #}
        <section class="adw-preferences-group">
            <h2 class="adw-preferences-group__title">Posts by {{ user_profile.username }}</h2>
            {% if posts_pagination and posts_pagination.items %}
                <div class="adw-list-box"> {# Removed 'selectable' as it's a custom attr, rows are 'activatable' via class #}
                    {% for post in posts_pagination.items %}
                    <a href="{{ url_for('view_post', post_id=post.id) }}" class="adw-action-row activatable">
                        <div class="adw-action-row__text">
                            <span class="adw-action-row__title">{{ post.title }}{% if not post.is_published and current_user == post.author %} (Draft){% endif %}</span>
                            <span class="adw-action-row__subtitle">
                                {% if post.is_published and post.published_at %}Published: {{ post.published_at.strftime('%Y-%m-%d %H:%M') }} UTC
                                {% elif not post.is_published %}Draft - Last updated: {{ post.updated_at.strftime('%Y-%m-%d %H:%M') }} UTC
                                {% else %}Created: {{ post.created_at.strftime('%Y-%m-%d %H:%M') }} UTC
                                {% endif %}
                            </span>
                        </div>
                        <span class="adw-action-row__chevron adw-icon icon-go-next-symbolic"></span>
                    </a>
                    {% endfor %}
                </div>

                {% if posts_pagination.pages > 1 %}
                <div class="adw-box" style="justify-content: center; margin-top: var(--spacing-l);">
                    <div class="adw-toggle-group linked">
                        {% if posts_pagination.has_prev %}
                            <a href="{{ url_for('profile', username=user_profile.username, page=posts_pagination.prev_num) }}" class="adw-button icon-only">
                                <span class="adw-icon icon-go-previous-symbolic"></span>
                            </a>
                        {% else %}
                            <button class="adw-button icon-only" disabled>
                                <span class="adw-icon icon-go-previous-symbolic"></span>
                            </button>
                        {% endif %}

                        {% for page_num in posts_pagination.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                            {% if page_num %}
                                {% if page_num == posts_pagination.page %}
                                    <button class="adw-button suggested-action" disabled aria-current="page">{{ page_num }}</button>
                                {% else %}
                                    <a href="{{ url_for('profile', username=user_profile.username, page=page_num) }}" class="adw-button">{{ page_num }}</a>
                                {% endif %}
                            {% elif loop.index != 1 and loop.index != posts_pagination.pages + 2 %}
                                <button class="adw-button flat" disabled style="pointer-events: none;">…</button>
                            {% endif %}
                        {% endfor %}

                        {% if posts_pagination.has_next %}
                            <a href="{{ url_for('profile', username=user_profile.username, page=posts_pagination.next_num) }}" class="adw-button icon-only">
                                <span class="adw-icon icon-go-next-symbolic"></span>
                            </a>
                        {% else %}
                            <button class="adw-button icon-only" disabled>
                                <span class="adw-icon icon-go-next-symbolic"></span>
                            </button>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            {% else %}
                <div class="adw-status-page">
                    <span class="adw-status-page-icon adw-icon icon-document-new-symbolic"></span>
                    <h3 class="adw-status-page-title">No Posts Yet</h3>
                    <p class="adw-status-page-description">{{ user_profile.username }} has not made any posts.</p>
                </div>
            {% endif %}
        </section>
    </div>
</div>
{% endblock %}
>>>>>>> REPLACE
