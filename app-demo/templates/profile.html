{% extends "base.html" %}

{% block title %}Profile: {{ user_profile.username }}{% endblock %}

{% block content %}
<adw-clamp style="max-width: 800px; margin: var(--spacing-xl) auto;">
    <adw-box orientation="vertical" spacing="l">

        {# User Header Info #}
        <adw-box orientation="horizontal" spacing="xl" style="align-items: center;">
            <adw-avatar
                size="96"
                image-src="{{ url_for('static', filename=user_profile.profile_photo_url) if user_profile.profile_photo_url else default_avatar_url }}"
                text="{{ user_profile.username }}">
            </adw-avatar>
            <adw-box orientation="vertical" spacing="xs">
                {% if user_profile.full_name %}
                    <adw-label title-level="1">{{ user_profile.full_name }}</adw-label>
                    <adw-label title-level="3" class="secondary-text">@{{ user_profile.username }}</adw-label>
                {% else %}
                    <adw-label title-level="1">@{{ user_profile.username }}</adw-label>
                {% endif %}
            </adw-box>
        </adw-box>

        {# Profile Details Group #}
        <adw-preferences-group title="About {{user_profile.username}}">
            {% if user_profile.profile_info %}
            <adw-expander-row title="Bio" subtitle="View user's biography">
                <div slot="content" style="padding: var(--spacing-m); color: var(--view-fg-color); white-space: pre-wrap;">
                    {{ user_profile.profile_info | safe }}
                </div>
            </adw-expander-row>
            {% else %}
            <adw-action-row title="Bio" subtitle="No bio provided."></adw-action-row>
            {% endif %}

            {% if user_profile.location %}
            <adw-action-row title="Location">
                <span slot="subtitle">{{ user_profile.location }}</span> {# Using span in subtitle slot for custom content #}
            </adw-action-row>
            {% endif %}

            {% if user_profile.website_url %}
                {% if user_profile.website_url.startswith('http://') or user_profile.website_url.startswith('https://') %}
                    <adw-action-row title="Website" show-chevron="true" href="{{ user_profile.website_url }}" target="_blank">
                         <span slot="subtitle">{{ user_profile.website_url }}</span>
                    </adw-action-row>
                {% else %}
                    <adw-action-row title="Website">
                        <span slot="subtitle">{{ user_profile.website_url }} (Not a valid link)</span>
                    </adw-action-row>
                {% endif %}
            {% endif %}

            {% if current_user == user_profile %}
             <adw-action-row title="Profile Privacy"
                            subtitle="{{ 'Public' if user_profile.is_profile_public else 'Private (Only you can see full details)' }}">
             </adw-action-row>
            {% endif %}
        </adw-preferences-group>

        {# Edit Profile Button #}
        {% if current_user == user_profile %}
        <adw-box orientation="horizontal" justify="start" style="margin-top: var(--spacing-m); margin-bottom: var(--spacing-l);">
            <adw-button href="{{ url_for('edit_profile') }}" class="suggested-action">Edit Profile</adw-button>
        </adw-box>
        {% endif %}

        {# User Posts Section #}
        <adw-preferences-group title="Posts by {{ user_profile.username }}">
            {% if posts_pagination and posts_pagination.items %}
                <adw-list-box>
                    {% for post in posts_pagination.items %}
                        <adw-action-row
                            title="{{ post.title }}"
                            subtitle="Posted on: {{ post.created_at.strftime('%Y-%m-%d %H:%M') if post.created_at else 'N/A' }} UTC"
                            href="{{ url_for('view_post', post_id=post.id) }}"
                            show-chevron="true"
                            clickable> {# Explicitly make it clickable if href is present #}
                        </adw-action-row>
                    {% endfor %}
                </adw-list-box>

                {# Pagination Controls - Standardized to match index.html #}
                {% if posts_pagination.pages > 1 %}
                <nav aria-label="User posts page navigation" class="pagination-nav" style="margin-top: var(--spacing-l); display: flex; justify-content: center; align-items: center; gap: var(--spacing-xs);">
                    {% if posts_pagination.has_prev %}
                        <adw-button href="{{ url_for('profile', username=user_profile.username, page=posts_pagination.prev_num) }}">&laquo; Previous</adw-button>
                    {% else %}
                        <adw-button disabled>&laquo; Previous</adw-button>
                    {% endif %}

                    {% for page_num in posts_pagination.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                        {% if page_num %}
                            {% if page_num == posts_pagination.page %}
                                <adw-button class="suggested-action" aria-current="page">{{ page_num }}</adw-button>
                            {% else %}
                                <adw-button href="{{ url_for('profile', username=user_profile.username, page=page_num) }}">{{ page_num }}</adw-button>
                            {% endif %}
                        {% else %}
                            <adw-button disabled class="flat" style="cursor: default; min-width: auto; padding: var(--spacing-xs);">&hellip;</adw-button>
                        {% endif %}
                    {% endfor %}

                    {% if posts_pagination.has_next %}
                         <adw-button href="{{ url_for('profile', username=user_profile.username, page=posts_pagination.next_num) }}">Next &raquo;</adw-button>
                    {% else %}
                        <adw-button disabled>Next &raquo;</adw-button>
                    {% endif %}
                </nav>
                {% endif %}
            {% else %}
                <adw-status-page title="No Posts Yet" description="{{ user_profile.username }} has not made any posts." style="padding: var(--spacing-xl) 0;">
                     <div slot="icon" style="font-size: 3rem; margin-bottom: var(--spacing-s); opacity: 0.7;">ðŸ“„</div>
                </adw-status-page>
            {% endif %}
        </adw-preferences-group>
    </adw-box>
</adw-clamp>
{% endblock %}
