{% extends "base.html" %}

{% block title %}Profile: {{ user_profile.username }}{% endblock %}

{% block content %}
<div class="adw-clamp" style="max-width: 800px; margin: var(--spacing-xl) auto;">
    <div class="adw-box vertical spacing-l">

        {# User Header Info #}
        <div class="adw-box horizontal spacing-xl" style="align-items: center;">
            <span class="adw-avatar size-96">
                <img src="{{ url_for('static', filename=user_profile.profile_photo_url) if user_profile.profile_photo_url else default_avatar_url }}" alt="{{ user_profile.username }} avatar" class="adw-avatar__image">
            </span>
            <div class="adw-box vertical spacing-xs">
                <h1 class="title-1" style="margin-bottom: {% if user_profile.full_name %}var(--spacing-xxs){% else %}0{% endif %};">{{ user_profile.full_name or user_profile.username }}</h1>
                {% if user_profile.full_name %}
                <p class="adw-caption" style="margin-top: 0;">@{{ user_profile.username }}</p> {# Use adw-caption and remove inline color #}
                {% endif %}
            </div>
        </div>

        {# Profile Details Group #}
        <div class="adw-preferences-group" role="group" aria-labelledby="profile-about-title">
            <div class="adw-preferences-group__title-container">
                <h3 class="adw-preferences-group__title" id="profile-about-title">About {{user_profile.username}}</h3>
            </div>
            {% if user_profile.profile_info %}
            <div class="adw-expander-row">
                <div class="adw-action-row activatable" role="button" tabindex="0" aria-expanded="false">
                    <div class="adw-action-row__text">
                        <span class="adw-action-row__title">Bio</span>
                        <span class="adw-action-row__subtitle">View user's biography</span>
                    </div>
                    <span class="adw-expander-row__chevron"></span>
                </div>
                <div class="adw-expander-row-content" style="padding: var(--spacing-m); color: var(--text-color); white-space: pre-wrap;">
                    {{ user_profile.profile_info | safe }}
                </div>
            </div>
            {% else %}
            <div class="adw-action-row">
                <div class="adw-action-row__text">
                    <span class="adw-action-row__title">Bio</span>
                    <span class="adw-action-row__subtitle">No bio provided.</span>
                </div>
            </div>
            {% endif %}

            {% if user_profile.location %}
            <div class="adw-action-row">
                <div class="adw-action-row__text">
                    <span class="adw-action-row__title">Location</span>
                </div>
                <span class="adw-action-row__subtitle">{{ user_profile.location }}</span>
            </div>
            {% endif %}

            {% if user_profile.website_url %}
                {% if user_profile.website_url.startswith('http://') or user_profile.website_url.startswith('https://') %}
                    <a href="{{ user_profile.website_url }}" target="_blank" class="adw-action-row activatable">
                        <div class="adw-action-row__text">
                            <span class="adw-action-row__title">Website</span>
                            <span class="adw-action-row__subtitle">{{ user_profile.website_url }}</span>
                        </div>
                        <span class="adw-action-row__chevron"></span>
                    </a>
                {% else %}
                    <div class="adw-action-row">
                        <div class="adw-action-row__text">
                            <span class="adw-action-row__title">Website</span>
                            <span class="adw-action-row__subtitle">{{ user_profile.website_url }} (Not a valid link)</span>
                        </div>
                    </div>
                {% endif %}
            {% endif %}

            {% if current_user == user_profile %}
             <div class="adw-action-row">
                 <div class="adw-action-row__text">
                    <span class="adw-action-row__title">Profile Privacy</span>
                    <span class="adw-action-row__subtitle">{{ 'Public' if user_profile.is_profile_public else 'Private (Only you can see full details)' }}</span>
                </div>
             </div>
            {% endif %}
        </div>

        {# Edit Profile Button #}
        {% if current_user == user_profile %}
        <div class="adw-box horizontal justify-start" style="margin-top: var(--spacing-m); margin-bottom: var(--spacing-l);">
            <a href="{{ url_for('edit_profile') }}" class="adw-button suggested-action">Edit Profile</a>
        </div>
        {% endif %}

        {# User Posts Section #}
        <div class="adw-preferences-group" role="group" aria-labelledby="profile-posts-title">
             <div class="adw-preferences-group__title-container">
                <h3 class="adw-preferences-group__title" id="profile-posts-title">Posts by {{ user_profile.username }}</h3>
            </div>
            {% if posts_pagination and posts_pagination.items %}
                <div class="adw-list-box">
                    {% for post in posts_pagination.items %}
                        <a href="{{ url_for('view_post', post_id=post.id) }}" class="adw-action-row activatable">
                            <div class="adw-action-row__text">
                                <span class="adw-action-row__title">{{ post.title }}{% if not post.is_published and current_user == post.author %} (Draft){% endif %}</span>
                                <span class="adw-action-row__subtitle">{% if post.is_published and post.published_at %}Published: {{ post.published_at.strftime('%Y-%m-%d %H:%M') }} UTC{% elif not post.is_published %}Draft - Last updated: {{ post.updated_at.strftime('%Y-%m-%d %H:%M') }} UTC{% else %}Created: {{ post.created_at.strftime('%Y-%m-%d %H:%M') }} UTC{% endif %}</span>
                            </div>
                            <span class="adw-action-row__chevron"></span>
                        </a>
                    {% endfor %}
                </div>

                {# Pagination Controls #}
                {% if posts_pagination.pages > 1 %}
                <nav aria-label="User posts page navigation" class="pagination-nav" style="margin-top: var(--spacing-l); display: flex; justify-content: center; align-items: center; gap: var(--spacing-xs);">
                    {% if posts_pagination.has_prev %}
                        <a href="{{ url_for('profile', username=user_profile.username, page=posts_pagination.prev_num) }}" class="adw-button">&laquo; Previous</a>
                    {% else %}
                        <button class="adw-button" disabled>&laquo; Previous</button>
                    {% endif %}

                    {% for page_num in posts_pagination.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                        {% if page_num %}
                            {% if page_num == posts_pagination.page %}
                                <button class="adw-button suggested-action" aria-current="page">{{ page_num }}</button>
                            {% else %}
                                <a href="{{ url_for('profile', username=user_profile.username, page=page_num) }}" class="adw-button">{{ page_num }}</a>
                            {% endif %}
                        {% else %}
                            <button class="adw-button flat" disabled style="cursor: default; min-width: auto; padding: var(--spacing-xs);">&hellip;</button>
                        {% endif %}
                    {% endfor %}

                    {% if posts_pagination.has_next %}
                         <a href="{{ url_for('profile', username=user_profile.username, page=posts_pagination.next_num) }}" class="adw-button">Next &raquo;</a>
                    {% else %}
                        <button class="adw-button" disabled>Next &raquo;</button>
                    {% endif %}
                </nav>
                {% endif %}
            {% else %}
                <div class="adw-status-page" style="padding: var(--spacing-xl) 0;">
                     <div class="adw-status-page-icon" style="font-size: 3rem; margin-bottom: var(--spacing-s); opacity: 0.7;">ðŸ“„</div>
                     <h3 class="adw-status-page-title">No Posts Yet</h3>
                     <p class="adw-status-page-description">{{ user_profile.username }} has not made any posts.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
